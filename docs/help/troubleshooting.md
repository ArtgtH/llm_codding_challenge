# Руководство по устранению неполадок

В этом руководстве рассматриваются распространенные проблемы, с которыми вы можете столкнуться при работе с системой, и предлагаются решения.

## Проблемы с Telegram-ботом

### Бот не отвечает на сообщения

**Симптомы**:
- Бот находится в чате, но не отвечает на сообщения
- Сообщения не появляются в логах сервиса-обработчика

**Возможные решения**:
1. Проверьте, запущен ли бот: `docker-compose ps tg_bot`
2. Убедитесь, что токен бота указан правильно в `tg_bot/src/.env`
3. Проверьте логи бота: `docker-compose logs -f tg_bot`
4. Убедитесь, что у бота есть разрешение на чтение сообщений в чате

### Бот не запускается

**Симптомы**:
- Сервис бота постоянно перезапускается
- В логах есть сообщения об ошибках подключения

**Возможные решения**:
1. Проверьте, запущен ли RabbitMQ: `docker-compose ps rabbitmq`
2. Проверьте URL-подключения к RabbitMQ в переменных окружения
3. Убедитесь, что PostgreSQL запущен: `docker-compose ps postgres`
4. Проверьте параметры подключения к PostgreSQL в переменных окружения

## Проблемы с сервисом-обработчиком

### Обработчик не обрабатывает сообщения

**Симптомы**:
- Сообщения отправляются Telegram-боту, но не обрабатываются
- Файлы Excel не создаются и не загружаются в Google Drive

**Возможные решения**:
1. Проверьте, запущен ли сервис-обработчик: `docker-compose ps worker`
2. Проверьте URL-подключения к RabbitMQ в переменных окружения
3. Проверьте логи обработчика: `docker-compose logs -f worker`
4. Убедитесь, что ключ API Mistral AI установлен правильно

### Ошибки анализа Mistral AI

**Симптомы**:
- Сообщения об ошибках, связанных с API Mistral, в логах обработчика
- Сообщения получаются, но структурированные данные не извлекаются

**Возможные решения**:
1. Проверьте ключ API Mistral AI в `worker/src/.env`
2. Проверьте наличие ограничений по количеству запросов к API
3. Изучите логи обработчика для получения подробных сообщений об ошибках
4. Попробуйте обработать сообщения с более простым текстом для тестирования

## Проблемы с Google Drive

### Файлы не загружаются

**Симптомы**:
- Сообщения обрабатываются, но файлы не появляются в Google Drive
- Сообщения об ошибках Google Drive в логах обработчика

**Возможные решения**:
1. Убедитесь, что файл учетных данных Google Drive API существует в правильном месте
2. Проверьте, что сервисный аккаунт имеет доступ к целевым папкам
3. Изучите логи обработчика для получения подробных сообщений об ошибках Google Drive
4. Проверьте путь к файлу в `worker/src/google_drive/google_drive_uploader.py`

### Неправильная организация файлов

**Симптомы**:
- Файлы загружаются, но не в ожидаемые папки
- Файлы разных команд смешиваются вместе

**Возможные решения**:
1. Проверьте конфигурацию URL папок в классе GoogleDriveUploader
2. Убедитесь, что название команды правильно извлекается из сообщений
3. Проверьте логику создания папок в `google_drive_uploader.py`

## Проблемы с базой данных

### Сбои подключения к базе данных

**Симптомы**:
- Сообщения об ошибках подключения к базе данных в логах
- Сервисы бота или обработчика постоянно перезапускаются

**Возможные решения**:
1. Убедитесь, что PostgreSQL запущен: `docker-compose ps postgres`
2. Проверьте параметры подключения к базе данных в переменных окружения
3. Попробуйте подключиться к базе данных вручную для проверки учетных данных
4. Проверьте логи базы данных: `docker-compose logs -f postgres`

### Проблемы с миграцией базы данных

**Симптомы**:
- Сообщения об ошибках отсутствия таблиц или столбцов
- Сервисы не запускаются или не обрабатывают сообщения

**Возможные решения**:
1. Проверьте, правильно ли инициализирована схема базы данных
2. Убедитесь, что модели базы данных соответствуют схеме базы данных
3. Запустите миграции базы данных, если применимо

## Проблемы с RabbitMQ

### Проблемы с подключением к очереди

**Симптомы**:
- Сервисы не могут подключиться к RabbitMQ
- Сообщения об ошибках подключения AMQP

**Возможные решения**:
1. Убедитесь, что RabbitMQ запущен: `docker-compose ps rabbitmq`
2. Проверьте URL-подключения к RabbitMQ в переменных окружения
3. Проверьте логи RabbitMQ: `docker-compose logs -f rabbitmq`
4. Попробуйте получить доступ к интерфейсу управления RabbitMQ (http://localhost:15672)

### Сообщения не обрабатываются

**Симптомы**:
- Сообщения появляются в очереди RabbitMQ, но не потребляются
- Размер очереди продолжает расти

**Возможные решения**:
1. Проверьте, запущен ли сервис-обработчик: `docker-compose ps worker`
2. Проверьте имя очереди в переменных окружения
3. Изучите логи обработчика на наличие ошибок, связанных с потребителем
4. Проверьте интерфейс управления RabbitMQ для отслеживания состояния очереди 