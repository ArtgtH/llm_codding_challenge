# Интеграция с Google Drive

В этом документе описывается функциональность интеграции с Google Drive, используемая для хранения документов, созданных на основе сельскохозяйственных отчетов.

## Обзор

Приложение сохраняет два типа документов в Google Drive:

1. **Документы Word**: Исходные тексты сообщений, преобразованные в формат Word
2. **Электронные таблицы Excel**: Структурированные сельскохозяйственные данные, извлеченные из сообщений

## Компоненты

### Загрузчик Google Drive

Класс `GoogleDriveUploader` (`google_drive_uploader.py`) обрабатывает все взаимодействия с Google Drive:

1. Аутентифицируется в Google Drive с использованием учетных данных сервисного аккаунта
2. Создает папки и подпапки для организации документов
3. Загружает новые файлы и обновляет существующие файлы
4. Предоставляет URL-адреса файлов и папок для ссылок

### Утилиты

Файл `utils.py` предоставляет вспомогательные функции для интеграции с Google Drive:

1. `text_to_word_bytes()`: Преобразует текстовые сообщения в байты документа Word
2. `get_document_name()`: Создает стандартизированные имена файлов для документов Word
3. `get_table_name()`: Создает стандартизированные имена файлов для электронных таблиц Excel

## Аутентификация

Аутентификация в Google Drive использует сервисный аккаунт:

1. JSON-файл учетных данных хранится в `google_drive/api_key/`
2. Сервисный аккаунт должен иметь доступ к целевым папкам Google Drive
3. Путь к файлу учетных данных настраивается в `google_drive_uploader.py`

## Структура папок

Документы в Google Drive организованы в иерархическую структуру:

```
[Корневая папка]
├── [Папка команды 1]
│   ├── word_document_1.docx
│   ├── word_document_2.docx
│   └── excel_report.xlsx
└── [Папка команды 2]
    ├── word_document_1.docx
    ├── word_document_2.docx
    └── excel_report.xlsx
```

Папки команд создаются автоматически, если они не существуют.

## Именование файлов

Файлы именуются по стандартизированным соглашениям:

### Документы Word

Документы Word используют соглашение об именовании:
```
{имя_отправителя}_{номер_сообщения}_{форматированная_дата}.docx
```

Например:
```
Иванов_3_2023-04-15.docx
```

### Электронные таблицы Excel

Электронные таблицы Excel используют соглашение об именовании:
```
{имя_команды}_operations_log.xlsx
```

Например:
```
SlovarikDB_operations_log.xlsx
```

## Режимы загрузки

Загрузчик поддерживает различные режимы загрузки:

- **W (Запись)**: Создает новый файл, выдает ошибку, если файл уже существует
- **RW (Чтение-запись)**: Обновляет существующий файл, если он существует, в противном случае создает новый файл

## Обработка ошибок

Интеграция с Google Drive включает обработку ошибок для:

1. Ошибок аутентификации
2. Проблем с сетевым подключением
3. Проблем с разрешениями
4. Ошибок создания и обновления файлов 